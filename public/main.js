var debug=!0,debugInput=document.getElementById("debug");debugInput.value="";var playerNum,playerName,rerolls,TAU=2*Math.PI,scene="title",LOBBY_OPTIONS=["join game","create game","vs bot"],lobbyCursor=0,gamesAvailable=!1,waitingForPlayer=!1,names=["",""],socket=io();socket.on("welcome",function(e){debugInput.value="Welcome "+e.name+"!",playerName=e.name,rerolls=e.rerolls,(gamesAvailable=e.gamesAvailable)||(lobbyCursor=1)}),socket.on("player num",function(e){playerNum=e}),socket.on("game created",function(e){debugInput.value="Created game, waiting for player... ",playerNum=e}),socket.on("games available",function(){gamesAvailable=!0}),socket.on("no games available",function(){gamesAvailable=!1}),socket.on("new name",function(e){playerName=e.name,rerolls=e.rerolls}),socket.on("reroll limit",function(e){debugInput.value=e}),socket.on("change scene",function(e){switch(scene=e){case"lobby":titleX<SCREEN_W/2&&(titleX=SCREEN_W/2),animateTitle||(animateTitle=!0),lobbyCursor=gamesAvailable?0:1;break;case"game":prerenderField();break;case"gameover":prerenderGameover()}}),socket.on("start game",function(e){console.log("start game, %d",playerNum),debugInput.value=e.join(" vs "),names[0]=e[0],names[1]=e[1],waitingForPlayer=!1,prerenderField(),scene="game"}),socket.on("start bot match",function(e){playerNum=0,console.log("start game, %d",playerNum),debugInput.value=playerName+" vs "+e,names[0]=playerName,names[1]=e,waitingForPlayer=!1,prerenderField(),scene="game"}),socket.on("rematch",function(e){console.log("rematch, %d",playerNum),debugInput.value=names.join(" vs "),prerenderField(),scene="game"}),socket.on("game exists",function(e){debugInput.value=e}),socket.on("update",function(e){players=e.players,lives=e.lives,spriteClips=e.spriteClips,asleep=e.asleep,grenade=e.grenade,grenadeState=e.grenadeState,grenadeSpeeds=e.grenadeSpeeds,powerups=e.powerups,tranquilizers=e.tranquilizers,powerupMessages=e.powerupMessages,startCountdown=e.startCountdown,"gameover"===e.scene&&(scene="gameover",winner=e.winner,lostPlayer=e.lostPlayer,prerenderGameover())}),socket.on("play sound",function(e,t){switch(console.log(e),e){case"ricochet":playRicochetSound();break;case"punch":playPunchSound(t);break;case"explosion":playExplodeSound(t);break;case"play":music.currentTime=0,music.play();break;case"pause":music.pause()}}),socket.on("wants rematch",function(e){console.log("Wants rematch!"),spriteClips[2*e]=7}),socket.on("opponent disconnected",function(){scene="lobby",lobbyCursor=gamesAvailable?0:1,socket.emit("opponent disconnected")});var context=document.getElementById("canvas").getContext("2d");context.lineJoin="round",context.lineWidth=2,context.textAlign="center";var SCREEN_W=context.canvas.width,SCREEN_H=context.canvas.height,titleX=SCREEN_W/-2,titleY=SCREEN_H/2,animateTitle=!0,spritesheet=document.getElementById("spritesheet"),SNAKE_W=36,SNAKE_H=64,TILE_SIZE=32,PALETTE=["","#FFF","#000","#214a4a","#de946b"],prerender=document.getElementById("prerender"),preContext=prerender.getContext("2d");function prerenderField(){preContext.clearRect(0,0,SCREEN_W,SCREEN_H),preContext.lineWidth=2,preContext.strokeStyle="#333",preContext.fillStyle=PALETTE[3];for(var e=1;e<7;e++)preContext.fillRect(0,e*TILE_SIZE,TILE_SIZE,TILE_SIZE),preContext.strokeRect(0,e*TILE_SIZE,TILE_SIZE,TILE_SIZE),preContext.fillRect(SCREEN_W-TILE_SIZE,e*TILE_SIZE,TILE_SIZE,TILE_SIZE),preContext.strokeRect(SCREEN_W-TILE_SIZE,e*TILE_SIZE,TILE_SIZE,TILE_SIZE);for(e=7*TILE_SIZE;e<13*TILE_SIZE;e+=SNAKE_H)preContext.drawImage(spritesheet,5*SNAKE_W,2*SNAKE_H,SNAKE_W,SNAKE_H,0,e,SNAKE_W,SNAKE_H),preContext.drawImage(spritesheet,5*SNAKE_W,2*SNAKE_H,SNAKE_W,SNAKE_H,SCREEN_W-(SNAKE_W-2),e,SNAKE_W,SNAKE_H);for(e=13;e<19;e++)preContext.fillRect(0,e*TILE_SIZE,TILE_SIZE,TILE_SIZE),preContext.strokeRect(0,e*TILE_SIZE,TILE_SIZE,TILE_SIZE),preContext.fillRect(SCREEN_W-TILE_SIZE,e*TILE_SIZE,TILE_SIZE,TILE_SIZE),preContext.strokeRect(SCREEN_W-TILE_SIZE,e*TILE_SIZE,TILE_SIZE,TILE_SIZE);for(var t=0;t<32;t++)preContext.fillRect(t*TILE_SIZE,0,TILE_SIZE,TILE_SIZE),preContext.strokeRect(t*TILE_SIZE,0,TILE_SIZE,TILE_SIZE),preContext.fillRect(t*TILE_SIZE,SCREEN_H-TILE_SIZE,TILE_SIZE,TILE_SIZE),preContext.strokeRect(t*TILE_SIZE,SCREEN_H-TILE_SIZE,TILE_SIZE,TILE_SIZE);preContext.beginPath(),preContext.moveTo(SCREEN_W/2-1.15*TILE_SIZE,SCREEN_H-2*TILE_SIZE),preContext.arc(SCREEN_W/2,SCREEN_H/2,2.5*TILE_SIZE,.65*Math.PI,1.35*Math.PI),preContext.lineTo(SCREEN_W/2-1.15*TILE_SIZE,2*TILE_SIZE),preContext.moveTo(SCREEN_W/2+1.15*TILE_SIZE,2*TILE_SIZE),preContext.arc(SCREEN_W/2,SCREEN_H/2,2.5*TILE_SIZE,1.65*Math.PI,.35*Math.PI),preContext.lineTo(SCREEN_W/2+1.15*TILE_SIZE,SCREEN_H-2*TILE_SIZE),preContext.stroke(),preContext.closePath()}function prerenderGameover(){preContext.fillStyle="#333",preContext.fillRect(0,0,SCREEN_W,SCREEN_H),preContext.textAlign="center",preContext.font="72px Gugi",preContext.fillStyle=PALETTE[3],preContext.strokeStyle=PALETTE[1],preContext.lineWidth=2,preContext.strokeText(names[winner]+" wins!",SCREEN_W/2,SCREEN_H/4),preContext.fillText(names[winner]+" wins!",SCREEN_W/2,SCREEN_H/4),preContext.font="32px Gugi",preContext.strokeText("Remaining Lives: "+lives[winner],SCREEN_W/2,SCREEN_H/2),preContext.fillText("Remaining Lives: "+lives[winner],SCREEN_W/2,SCREEN_H/2),preContext.font="24px monospace",preContext.fillStyle=PALETTE[1],preContext.fillText("Press spacebar to rematch "+names[(playerNum+1)%2],SCREEN_W/2,.7*SCREEN_H),preContext.fillText('Press "r" to return to the lobby',SCREEN_W/2,.8*SCREEN_H)}prerenderField(),spritesheet.onload=prerenderField;var preX,preY,aContext,POWERUP_RADIUS=12,POWERUP_SIZE=32,HALF_POWERUP_SIZE=POWERUP_SIZE/2,powerups=new Uint16Array(8),POWERUP_MESSAGE_TEXT=["","Tranquilizer!","Slow Grenade!","Fast Grenade!"],powerupMessages=new Uint16Array(4),tranquilizers=new Uint16Array(6),powerupsCanvas=document.getElementById("powerups"),powerupsContext=powerupsCanvas.getContext("2d"),TRANQUILIZER_PIXELS=new Uint8Array([2,2,2,2,2,2,2,2,2,0,0,2,3,1,1,1,3,3,2,3,2,0,2,3,3,3,3,3,3,3,3,2,0,0,2,2,2,2,2,3,0,3,2,0,0,0,0,0,0,0,2,3,3,3,2,0,0,0,0,0,0,0,2,3,3,2,0,0,0,0,0,0,0,2,3,3,2,0,0,0,0,0,0,0,0,2,2,2]);preX=5;for(var i=preY=0;i<TRANQUILIZER_PIXELS.length;i++)0<TRANQUILIZER_PIXELS[i]&&(powerupsContext.fillStyle=PALETTE[TRANQUILIZER_PIXELS[i]],powerupsContext.fillRect(32-(preX+i%11*2),preY+2*(i/11>>0),2,2),powerupsContext.fillRect(preX+i%11*2,preY+2*(i/11>>0)+16,2,2));powerupsContext.font="16px Gugi",powerupsContext.textAlign="center",powerupsContext.beginPath(),powerupsContext.arc(48,16,POWERUP_RADIUS,0,TAU),powerupsContext.lineWidth=4,powerupsContext.strokeStyle="#000",powerupsContext.stroke(),powerupsContext.lineWidth=2,powerupsContext.strokeStyle="#3AF",powerupsContext.stroke(),powerupsContext.closePath(),powerupsContext.strokeStyle="#000",powerupsContext.strokeText("S",48,22),powerupsContext.fillStyle="#3AF",powerupsContext.fillText("S",48,22),powerupsContext.beginPath(),powerupsContext.arc(80,16,POWERUP_RADIUS,0,TAU),powerupsContext.lineWidth=4,powerupsContext.strokeStyle="#000",powerupsContext.stroke(),powerupsContext.lineWidth=2,powerupsContext.strokeStyle="#C73",powerupsContext.stroke(),powerupsContext.closePath(),powerupsContext.strokeStyle="#000",powerupsContext.strokeText("F",80,22),powerupsContext.fillStyle="#C73",powerupsContext.fillText("F",80,22),"undefined"==typeof AudioContext?("undefined"==typeof webkitAudioContext&&(aContext=!1),aContext=new webkitAudioContext):aContext=new AudioContext;var soundsVolume=1;function calculateGain(e,t,n){var o;switch(t){case"sine":o=n?2:1;break;case"triangle":o=n?3:1;break;case"sawtooth":o=n?10:2;break;case"square":o=n?11:3}return soundsVolume*(Math.pow(1.05,e/-20)/o)}function playPunchSound(e){if(!aContext||aContext.muted)return 0;var t=aContext.currentTime,n=aContext.createOscillator(),o=aContext.createGain();n.connect(o),o.connect(aContext.destination);var r=0==e?55:37;n.frequency.value=r,n.type="square",o.gain.setValueAtTime(calculateGain(r,"square"),t),o.gain.linearRampToValueAtTime(0,t+.2),n.start(t),n.stop(t+.2)}function playRicochetSound(e){if(!aContext||aContext.muted)return 0;var t=aContext.currentTime,n=aContext.createOscillator(),o=aContext.createGain();n.connect(o),o.connect(aContext.destination);n.frequency.value=220,n.type="square",o.gain.setValueAtTime(calculateGain(220,"square"),t),o.gain.linearRampToValueAtTime(0,t+.2),n.start(t),n.stop(t+.2)}function playExplodeSound(e){if(!aContext||aContext.muted)return 0;var t=aContext.currentTime,n=aContext.createOscillator(),o=aContext.createGain();n.connect(o),o.connect(aContext.destination);var r=0==e?220:148,a=calculateGain(r,n.type="square");o.gain.setValueAtTime(a,t),o.gain.setValueAtTime(a,t+.3),o.gain.linearRampToValueAtTime(0,t+.4),n.frequency.setValueAtTime(r,t),n.frequency.exponentialRampToValueAtTime(r/4,t+.4),n.start(t),n.stop(t+.4)}var music=document.getElementById("music");music.pause();var muteMusic=document.getElementById("mute-music");function toggleMuteMusic(){music.muted=muteMusic.checked}muteMusic.addEventListener("change",toggleMuteMusic),toggleMuteMusic();var muteSounds=document.getElementById("mute-sounds");function toggleMuteSounds(){aContext.muted=muteSounds.checked}muteSounds.addEventListener("change",toggleMuteSounds),toggleMuteSounds();var musicVolumeRange=document.getElementById("volume-music");function updateMusicVolume(){var e=parseFloat(musicVolumeRange.value);"number"!=typeof e||isNaN(e)||(music.volume=e)}musicVolumeRange.addEventListener("input",updateMusicVolume),updateMusicVolume();var soundsVolumeRange=document.getElementById("volume-sounds");function updateSoundsVolume(){var e=parseFloat(soundsVolumeRange.value);"number"!=typeof e||isNaN(e)||(soundsVolume=e)}soundsVolumeRange.addEventListener("input",updateSoundsVolume),updateSoundsVolume();var x,y,GRENADE_POINTS=new Uint8Array([0,0,1,1,2,0,2,3,2,1,2,3,2,3,2,2,3,2,3,2,3,3,3,3,3,2,3,2,3,2,0,2,3,2,0]),grenadeSprites=document.getElementById("grenade"),grenadeContext=grenadeSprites.getContext("2d");for(i=0;i<GRENADE_POINTS.length;i++)0!==GRENADE_POINTS[i]&&(x=i%5*2,y=2*(i/5>>0),grenadeContext.fillStyle=PALETTE[GRENADE_POINTS[i]],grenadeContext.fillRect(x+2,y,2,2),grenadeContext.fillRect(y+14,x+2,2,2),grenadeContext.fillRect(38-x,12-y,2,2),grenadeContext.fillRect(54-y,10-x,2,2));var startCountdown,GRENADE_SIZE=12,grenade=new Uint16Array(6),grenadeSpeeds=new Uint8Array(2),grenadeState=0,head=document.getElementById("life-head"),headContext=head.getContext("2d");headContext.fillStyle="#FFF",headContext.fillRect(0,2,14,12),headContext.fillRect(2,0,10,16),headContext.fillStyle="#000",headContext.fillRect(2,4,2,8),headContext.fillRect(4,2,6,2),headContext.fillRect(4,12,4,2),headContext.fillRect(4,4,8,2),headContext.fillRect(8,6,4,4),headContext.fillRect(8,10,2,2),headContext.fillStyle=PALETTE[3],headContext.fillRect(4,6,4,2),headContext.fillRect(6,10,2,2),headContext.fillStyle=PALETTE[4],headContext.fillRect(4,8,4,2),headContext.fillRect(4,10,2,2),headContext=null;var lostPlayer,winner,MAX_LIVES=5,lives=new Uint8Array([5,5]),PLAYER_FRAME_MAX=180,players=new Uint16Array(8),asleep=new Uint16Array(2),playersFrames=new Uint16Array([0,0]),spriteClips=new Uint8Array(4),KEY_MAP={r:"reroll",ArrowUp:"up",ArrowDown:"down",ArrowLeft:"left",ArrowRight:"right"," ":"punch"};function handleKeyDown(e){if(!(e.altKey||e.ctrlKey||e.metaKey||(e.preventDefault(),e.repeat))){var t=KEY_MAP[e.key];switch(scene){case"lobby":switch(t){case"reroll":socket.emit("reroll name");break;case"up":(gamesAvailable?0:1)<lobbyCursor&&lobbyCursor--;break;case"down":lobbyCursor<2&&lobbyCursor++;break;case"punch":switch(LOBBY_OPTIONS[lobbyCursor]){case"join game":gamesAvailable?socket.emit("join game"):lobbyCursor=1;break;case"create game":waitingForPlayer||(socket.emit("create game"),waitingForPlayer=!0);break;case"vs bot":waitingForPlayer||socket.emit("vs bot")}}break;case"gameover":"punch"===t&&(spriteClips[2*playerNum]=7);default:socket.emit("keydown",{action:t})}}}function handleKeyUp(e){socket.emit("keyup",{action:KEY_MAP[e.key]})}document.addEventListener("keydown",handleKeyDown),document.addEventListener("keyup",handleKeyUp);var DELTA_TIME=5,MAX_ACCUMULATION=60,accumulator=DELTA_TIME,lastTimestamp=Date.now(),frames=0;function frameStep(e){var t=Date.now();switch(MAX_ACCUMULATION<(accumulator+=t-lastTimestamp)&&(accumulator=DELTA_TIME),lastTimestamp=t,scene){case"title":for(;DELTA_TIME<=accumulator;)accumulator-=DELTA_TIME,animateTitle&&SCREEN_W/2<=(titleX+=8)&&(titleX=SCREEN_W/2,animateTitle=!1);context.clearRect(0,0,SCREEN_W,SCREEN_H),context.fillStyle="#000",context.fillRect(0,0,SCREEN_W,SCREEN_H),context.fillStyle=PALETTE[3],context.strokeStyle=PALETTE[4],context.font="bold 128px Fugaz One, Arial",context.fillText("Pong",titleX-8,titleY-112),context.strokeText("Pong",titleX-8,titleY-112),context.fillText("Gear",titleX+8,titleY),context.strokeText("Gear",titleX+8,titleY),animateTitle||(context.font="32px Gugi",context.fillStyle=PALETTE[4],context.fillText("Tactical Sports Action",SCREEN_W/2,SCREEN_H/2+64),context.font="24px monospace",frames%45<22&&context.fillText("Press any key to start",SCREEN_W/2,SCREEN_H-112));break;case"lobby":for(context.clearRect(0,0,SCREEN_W,SCREEN_H),context.fillStyle="#000",context.fillRect(0,0,SCREEN_W,SCREEN_H);DELTA_TIME<=accumulator;)accumulator-=DELTA_TIME,animateTitle&&(titleX<=192?titleX=192:titleX-=5,titleY<=256?titleY=256:titleY--,192===titleX&&256===titleY&&(animateTitle=!1));context.font="32px Gugi",context.textAlign="left",context.fillStyle=PALETTE[4],context.strokeStyle=PALETTE[4],waitingForPlayer?context.fillText("Waiting for player...",480,304):(gamesAvailable?context.fillText("Join Game",480,256):context.strokeText("Join Game (no games to join)",480,256),context.fillText("Create Game",480,304),context.fillText("VS Bot",480,352),context.beginPath(),context.moveTo(464,244+48*lobbyCursor),context.lineTo(440,236+48*lobbyCursor),context.lineTo(440,252+48*lobbyCursor),context.closePath(),context.stroke()),context.font="24px Gugi",context.fillText("Directives: ",SCREEN_W-480,32),context.fillText("Punch the grenade to deflect it; if you",SCREEN_W-480,80),context.fillText("get hit or the grenade enters your goal,",SCREEN_W-480,112),context.fillText("you lose a life.",SCREEN_W-480,144),context.fillText("Name: "+playerName,16,SCREEN_H-112),context.fillText('Press "r" to change your name.',16,SCREEN_H-64),context.fillText("Remaining rerolls: "+rerolls,16,SCREEN_H-32),context.fillText("Game Controls:",SCREEN_W-256,SCREEN_H-112),context.fillText("Arrow keys: move",SCREEN_W-256,SCREEN_H-64),context.fillText("Spacebar: punch",SCREEN_W-256,SCREEN_H-32),context.fillStyle=PALETTE[3],context.strokeStyle=PALETTE[4],context.font="bold 128px Fugaz One, Arial",context.textAlign="center",context.fillText("Pong",titleX-8,titleY-112),context.strokeText("Pong",titleX-8,titleY-112),context.fillText("Gear",titleX+8,titleY),context.strokeText("Gear",titleX+8,titleY);break;case"game":for(;DELTA_TIME<=accumulator;)accumulator-=DELTA_TIME,0!==startCountdown&&(startCountdown-=DELTA_TIME)<=0&&(startCountdown=0);if(context.clearRect(0,0,SCREEN_W,SCREEN_H),context.drawImage(prerender,0,0,SCREEN_W,SCREEN_H),1===powerups[2]?context.drawImage(powerupsCanvas,0,0,POWERUP_SIZE,HALF_POWERUP_SIZE,powerups[0]-HALF_POWERUP_SIZE,powerups[1]-HALF_POWERUP_SIZE,POWERUP_SIZE,HALF_POWERUP_SIZE):0!==powerups[2]&&context.drawImage(powerupsCanvas,POWERUP_SIZE*(powerups[2]-1),0,POWERUP_SIZE,POWERUP_SIZE,powerups[0]-HALF_POWERUP_SIZE,powerups[1]-HALF_POWERUP_SIZE,POWERUP_SIZE,POWERUP_SIZE),1===powerups[6]?context.drawImage(powerupsCanvas,0,HALF_POWERUP_SIZE,POWERUP_SIZE,HALF_POWERUP_SIZE,powerups[4]-HALF_POWERUP_SIZE,powerups[5]-HALF_POWERUP_SIZE,POWERUP_SIZE,HALF_POWERUP_SIZE):0!==powerups[6]&&context.drawImage(powerupsCanvas,POWERUP_SIZE*(powerups[6]-1),0,POWERUP_SIZE,POWERUP_SIZE,powerups[4]-HALF_POWERUP_SIZE,powerups[5]-HALF_POWERUP_SIZE,POWERUP_SIZE,POWERUP_SIZE),1===tranquilizers[2]?context.drawImage(powerupsCanvas,0,0,POWERUP_SIZE,HALF_POWERUP_SIZE,players[0]+SNAKE_W/2,players[1]-HALF_POWERUP_SIZE/2,POWERUP_SIZE,HALF_POWERUP_SIZE):2===tranquilizers[2]&&(context.fillStyle="#FFF",context.fillRect(tranquilizers[0]-2,tranquilizers[1]-2,4,4)),1===tranquilizers[5]?context.drawImage(powerupsCanvas,0,HALF_POWERUP_SIZE,POWERUP_SIZE,HALF_POWERUP_SIZE,players[4]-(SNAKE_W/2+POWERUP_SIZE),players[5]-HALF_POWERUP_SIZE/2,POWERUP_SIZE,HALF_POWERUP_SIZE):2===tranquilizers[5]&&(context.fillStyle="#FFF",context.fillRect(tranquilizers[3]-2,tranquilizers[4]-2,4,4)),context.textAlign="center",context.drawImage(spritesheet,spriteClips[0]*SNAKE_W,spriteClips[1]*SNAKE_H,SNAKE_W,SNAKE_H,players[0]-SNAKE_W/2,players[1]-SNAKE_H/2,SNAKE_W,SNAKE_H),asleep[0]&&(context.font=16+(asleep[0]%200<100?8:0)+"px monospace",context.strokeStyle="#000",context.fillStyle="#FFF",context.strokeText("Z",players[0]+SNAKE_W/2,players[1]-SNAKE_H/2),context.fillText("Z",players[0]+SNAKE_W/2,players[1]-SNAKE_H/2)),context.drawImage(spritesheet,spriteClips[2]*SNAKE_W,spriteClips[3]*SNAKE_H,SNAKE_W,SNAKE_H,players[4]-SNAKE_W/2,players[5]-SNAKE_H/2,SNAKE_W,SNAKE_H),asleep[1]&&(context.font=16+(asleep[1]%200<100?8:0)+"px monospace",context.strokeStyle="#000",context.fillStyle="#FFF",context.strokeText("Z",players[4]+SNAKE_W/2,players[5]-SNAKE_H/2),context.fillText("Z",players[4]+SNAKE_W/2,players[5]-SNAKE_H/2)),0===grenadeState)context.drawImage(grenadeSprites,grenade[5],0,14,14,grenade[0],grenade[1],14,14);else if(1===grenadeState){var n=grenade[5]<3*SNAKE_W?SNAKE_W:2*SNAKE_W;context.drawImage(spritesheet,grenade[5],2*SNAKE_H,n,SNAKE_H,grenade[0]+GRENADE_SIZE/2-n/2,grenade[1]+GRENADE_SIZE/2-SNAKE_H/2,n,SNAKE_H)}context.font="16px Gugi",context.lineWidth=4,context.strokeStyle="#000",context.fillStyle="#FFF",125<powerupMessages[1]%250&&(context.strokeText(POWERUP_MESSAGE_TEXT[powerupMessages[0]],SCREEN_W/4,SCREEN_H/2+8),context.fillText(POWERUP_MESSAGE_TEXT[powerupMessages[0]],SCREEN_W/4,SCREEN_H/2+8)),125<powerupMessages[3]%250&&(context.strokeText(POWERUP_MESSAGE_TEXT[powerupMessages[2]],.75*SCREEN_W,SCREEN_H/2+8),context.fillText(POWERUP_MESSAGE_TEXT[powerupMessages[2]],.75*SCREEN_W,SCREEN_H/2+8)),context.textAlign="right",context.strokeText(names[0]+": ",160,22),context.fillText(names[0]+": ",160,22),context.strokeText(names[1]+": ",SCREEN_W/2+160,22),context.fillText(names[1]+": ",SCREEN_W/2+160,22);for(var o=0;o<lives[0];o++)context.drawImage(head,168+o*head.width*1.5,8);for(o=0;o<lives[1];o++)context.drawImage(head,SCREEN_W/2+168+o*head.width*1.5,8);context.lineWidth=2;break;case"gameover":for(;DELTA_TIME<=accumulator;)accumulator-=DELTA_TIME,7!==spriteClips[2*winner]&&(playersFrames[winner]+=DELTA_TIME,180<=playersFrames[winner]&&(playersFrames[winner]-=180,spriteClips[2*winner]=5===spriteClips[2*winner]?6:5));context.drawImage(prerender,0,0),context.drawImage(spritesheet,spriteClips[0]*SNAKE_W,spriteClips[1]*SNAKE_H,SNAKE_W,SNAKE_H,players[0]-SNAKE_W/2,players[1]-SNAKE_H/2,SNAKE_W,SNAKE_H),context.drawImage(spritesheet,spriteClips[2]*SNAKE_W,spriteClips[3]*SNAKE_H,SNAKE_W,SNAKE_H,players[4]-SNAKE_W/2,players[5]-SNAKE_H/2,SNAKE_W,SNAKE_H)}if(17280===++frames&&(frames=0),!r)var r=e;e-r<2e3&&window.requestAnimationFrame(frameStep)}window.requestAnimationFrame(frameStep);